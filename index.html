<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TwoBob Tactics - Tetris Multiplayer (Debug)</title>
    <!-- ‡πÇ‡∏´‡∏•‡∏î socket.io ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏≤‡∏Å CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .screen {
            display: none;
            text-align: center;
            animation: fadeIn 0.5s ease-in;
            max-width: 600px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .menu-screen {
            display: block;
        }

        .game-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .connection-status {
            margin-bottom: 2rem;
            padding: 15px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .connected {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
            animation: pulse 2s infinite;
        }

        .disconnected {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #f44336;
        }

        .connecting {
            background: rgba(255, 193, 7, 0.3);
            border: 2px solid #ffc107;
            animation: blink 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        .debug-info {
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 300px;
            margin: 0 auto;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: linear-gradient(45deg, #666, #999);
        }

        .server-input {
            width: 100%;
            padding: 15px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            backdrop-filter: blur(10px);
            margin-bottom: 1rem;
        }

        .server-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
        }

        .log-info { color: #4ecdc4; }
        .log-error { color: #ff6b6b; }
        .log-success { color: #4CAF50; }
        .log-warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Menu Screen -->
        <div id="menu-screen" class="screen menu-screen">
            <h1 class="game-title">üéÆ TwoBob Tactics</h1>
            <div id="connection-status" class="connection-status disconnected">
                üî¥ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            </div>
            
            <!-- Server Configuration -->
            <div style="margin-bottom: 2rem;">
                <input id="server-url" class="server-input" 
                       type="text" 
                       placeholder="Server URL (‡πÄ‡∏ä‡πà‡∏ô https://your-server.onrender.com)"
                       value="">
                <button id="btn-connect" class="btn">üîå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</button>
            </div>

            <!-- Debug Information -->
            <div class="debug-info">
                <div id="debug-log">
                    <div class="log-info">üîç Debug Log:</div>
                </div>
            </div>

            <div class="menu-buttons">
                <button id="btn-create-room" class="btn" disabled>üè† ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
                <button id="btn-join-room" class="btn" disabled>üö™ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</button>
                <button id="btn-test-local" class="btn">üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Local Server</button>
            </div>
        </div>
    </div>

    <script>
        class TetrisDebugClient {
            constructor() {
                this.socket = null;
                this.connected = false;
                this.serverUrl = '';
                this.logs = [];
                
                this.setupEventListeners();
                this.log('Client initialized', 'info');
                
                // ‡∏•‡∏≠‡∏á default servers
                this.tryDefaultServers();
            }

            setupEventListeners() {
                document.getElementById('btn-connect').addEventListener('click', () => {
                    const url = document.getElementById('server-url').value.trim();
                    if (url) {
                        this.connectToServer(url);
                    } else {
                        this.log('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå', 'error');
                    }
                });

                document.getElementById('btn-test-local').addEventListener('click', () => {
                    this.connectToServer('http://localhost:3000');
                });

                // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                window.addEventListener('beforeunload', () => {
                    if (this.socket) {
                        this.socket.disconnect();
                    }
                });
            }

            async tryDefaultServers() {
                const defaultServers = [
                    'https://new-twobob.onrender.com',
                    'https://twobob-tactics.onrender.com', 
                    'http://localhost:3000'
                ];

                this.log('‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...', 'info');

                for (const server of defaultServers) {
                    this.log(`‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${server}`, 'info');
                    document.getElementById('server-url').value = server;
                    
                    // ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
                    const success = await this.testServerConnection(server);
                    if (success) {
                        this.log(`‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ${server} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
                        this.connectToServer(server);
                        return;
                    } else {
                        this.log(`‚ùå ${server} ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ`, 'error');
                    }
                }

                this.log('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î local server', 'warning');
            }

            async testServerConnection(url) {
                try {
                    // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ fetch ‡∏Å‡πà‡∏≠‡∏ô
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch(url, { 
                        signal: controller.signal,
                        mode: 'no-cors' // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢ CORS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                    });
                    
                    clearTimeout(timeoutId);
                    return true;
                } catch (error) {
                    this.log(`Fetch test failed: ${error.message}`, 'error');
                    return false;
                }
            }

            connectToServer(url) {
                this.log(`üîå ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ${url}`, 'info');
                this.updateConnectionStatus('connecting', 'üü° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');
                
                // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤
                if (this.socket) {
                    this.socket.disconnect();
                }

                this.serverUrl = url;
                
                try {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà
                    this.socket = io(url, {
                        transports: ['websocket', 'polling'], // ‡∏•‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÅ‡∏ö‡∏ö
                        timeout: 10000,
                        forceNew: true,
                        autoConnect: true
                    });

                    this.setupSocketEvents();
                    
                } catch (error) {
                    this.log(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ${error.message}`, 'error');
                    this.updateConnectionStatus('disconnected', 'üî¥ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }
            }

            setupSocketEvents() {
                this.socket.on('connect', () => {
                    this.log(`‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ID: ${this.socket.id}`, 'success');
                    this.connected = true;
                    this.updateConnectionStatus('connected', 'üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß');
                    this.enableGameButtons();
                });

                this.socket.on('disconnect', (reason) => {
                    this.log(`‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢: ${reason}`, 'error');
                    this.connected = false;
                    this.updateConnectionStatus('disconnected', 'üî¥ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢');
                    this.disableGameButtons();
                });

                this.socket.on('connect_error', (error) => {
                    this.log(`üö´ ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ${error.message}`, 'error');
                    this.updateConnectionStatus('disconnected', 'üî¥ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                    this.disableGameButtons();
                });

                this.socket.on('error', (error) => {
                    this.log(`‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${JSON.stringify(error)}`, 'error');
                });

                // Game events
                this.socket.on('room-created', (data) => {
                    this.log(`üè† ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.roomId}`, 'success');
                });

                this.socket.on('room-joined', (data) => {
                    this.log(`üö™ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.roomId}`, 'success');
                });

                this.socket.on('room-error', (data) => {
                    this.log(`üö´ ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏´‡πâ‡∏≠‡∏á: ${data.message}`, 'error');
                });
            }

            updateConnectionStatus(status, text) {
                const statusElement = document.getElementById('connection-status');
                statusElement.className = `connection-status ${status}`;
                statusElement.textContent = text;
            }

            enableGameButtons() {
                document.getElementById('btn-create-room').disabled = false;
                document.getElementById('btn-join-room').disabled = false;
            }

            disableGameButtons() {
                document.getElementById('btn-create-room').disabled = true;
                document.getElementById('btn-join-room').disabled = true;
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `[${timestamp}] ${message}`;
                
                this.logs.push({ message: logEntry, type });
                
                // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô logs
                if (this.logs.length > 50) {
                    this.logs.shift();
                }
                
                this.updateDebugDisplay();
                console.log(`[TetrisDebug] ${logEntry}`);
            }

            updateDebugDisplay() {
                const debugLog = document.getElementById('debug-log');
                debugLog.innerHTML = '<div class="log-info">üîç Debug Log:</div>';
                
                this.logs.slice(-10).forEach(log => {
                    const div = document.createElement('div');
                    div.className = `log-entry log-${log.type}`;
                    div.textContent = log.message;
                    debugLog.appendChild(div);
                });
                
                // Auto scroll
                debugLog.scrollTop = debugLog.scrollHeight;
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', () => {
            new TetrisDebugClient();
        });
    </script>
</body>
</html>
