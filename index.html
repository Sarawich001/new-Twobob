<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TwoBob Tactics - Tetris Multiplayer</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        /* Enhanced Waiting Screen Styles */
        .room-header {
            position: relative;
            margin-bottom: 20px;
        }

        .room-id {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .copy-notification {
            position: absolute;
            top: -40px;
            right: 0;
            background: #4ade80;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Enhanced Ready Indicators */
        .ready-indicators {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .ready-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .ready-indicator.player-ready {
            background: rgba(34, 197, 94, 0.1);
            border-color: #22c55e;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
        }

        .player-status.waiting {
            color: #94a3b8;
            animation: pulse 2s infinite;
        }

        .player-status.ready {
            color: #22c55e;
            font-weight: bold;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Share Section */
        .share-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
        }

        .share-title {
            text-align: center;
            margin-bottom: 12px;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .share-btn {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #60a5fa;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .share-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            transform: scale(1.05);
        }

        /* QR Modal */
        .qr-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .qr-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            color: white;
        }

        .qr-content img {
            margin: 20px 0;
            border-radius: 8px;
        }

        /* Enhanced Ready Button */
        .ready-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ready-btn:not(:disabled) {
            background: linear-gradient(45deg, #22c55e, #16a34a);
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(34, 197, 94, 0.5); }
            to { box-shadow: 0 0 20px rgba(34, 197, 94, 0.8); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: #22c55e;
        }

        .notification.info {
            background: #3b82f6;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Menu Screen -->
        <div id="menu-screen" class="screen menu-screen">
            <h1 class="game-title">üéÆ TwoBob Tactics</h1>
            <div id="connection-status" class="connection-status disconnected">
                üî¥ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            </div>
            <div class="menu-buttons">
                <button id="btn-create-room" class="btn">üè† ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
                <button id="btn-join-room" class="btn">üö™ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</button>
            </div>
        </div>

        <!-- Connection Screen -->
        <div id="connection-screen" class="screen">
            <h2>‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢</h2>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà...</p>
        </div>

        <!-- Create Room Dialog -->
        <div id="create-room-screen" class="screen">
            <h2>üè† ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h2>
            <div class="form-group">
                <input id="create-player-name" class="form-input" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô" maxlength="20">
            </div>
            <div class="menu-buttons">
                <button id="btn-confirm-create" class="btn">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
                <button onclick="showScreen('menu-screen')" class="btn">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>

        <!-- Join Room Dialog -->
        <div id="join-room-screen" class="screen">
            <h2>üö™ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</h2>
            <div class="form-group">
                <input id="join-player-name" class="form-input" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô" maxlength="20">
            </div>
            <div class="form-group">
                <input id="join-room-id" class="form-input" type="text" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á" maxlength="10">
            </div>
            <div class="menu-buttons">
                <button id="btn-confirm-join" class="btn">‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
                <button onclick="showScreen('menu-screen')" class="btn">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>

        <!-- Waiting Screen -->
        <div id="waiting-screen" class="screen">
            <div class="room-info">
                <div class="room-header">
                    <div class="room-id">
                        ‡∏´‡πâ‡∏≠‡∏á: <span id="room-id-display">-</span>
                        <button id="btn-copy-room" class="copy-btn" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div id="copy-notification" class="copy-notification">‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</div>
                </div>

                <h3>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á:</h3>
                <ul id="players-list" class="players-list">
                </ul>
                
                <div id="ready-indicators" class="ready-indicators">
                    <div id="ready-indicator-1" class="ready-indicator">
                        <div class="player-avatar">üë§</div>
                        <div class="player-info">
                            <div class="player-name">Player 1</div>
                            <div class="player-status waiting">‡∏£‡∏≠...</div>
                        </div>
                    </div>
                    <div id="ready-indicator-2" class="ready-indicator">
                        <div class="player-avatar">üë§</div>
                        <div class="player-info">
                            <div class="player-name">Player 2</div>
                            <div class="player-status waiting">‡∏£‡∏≠...</div>
                        </div>
                    </div>
                </div>

                <!-- Share Options -->
                <div class="share-section">
                    <div class="share-title">‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</div>
                    <div class="share-buttons">
                        <button id="btn-share-link" class="share-btn">
                            <i class="fas fa-link"></i> ‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå
                        </button>
                        <button id="btn-share-qr" class="share-btn">
                            <i class="fas fa-qrcode"></i> QR Code
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="menu-buttons">
                <button id="btn-ready" class="btn ready-btn" disabled>üéÆ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
                <button id="btn-leave-room" class="btn">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á</button>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-container">
                <!-- Left Panel - Player Info & Next Piece -->
                <div class="left-panel">
                    <div class="player-info-card">
                        <div class="player-label">PLAYER</div>
                        <div id="my-player-name" class="player-name-display">YOU</div>
                        <div style="margin-top: 10px; font-size: 0.9rem;">LEVEL</div>
                        <div style="font-size: 1.5rem; font-weight: bold;" id="my-level">1</div>
                    </div>
                    
                    <div class="next-piece-container">
                        <div class="next-piece-title">NEXT PIECE</div>
                        <div id="next-piece-display" class="next-piece"></div>
                    </div>
                    
                    <div class="stats-card">
                        <div style="margin-bottom: 10px;">
                            <div style="color: #00ffff; font-weight: bold;">SCORE</div>
                            <div style="font-size: 1.2rem;" id="my-score">0</div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <div style="color: #00ffff; font-weight: bold;">LINES</div>
                            <div id="my-lines">0</div>
                        </div>
                        <div>
                            <div style="color: #00ffff; font-weight: bold;">HIGH SCORE</div>
                            <div style="font-size: 1.1rem;">9999</div>
                        </div>
                    </div>
                </div>
                
                <!-- Center - Main Game Board -->
                <div class="main-player-area">
                    <div id="my-board" class="tetris-board main-board"></div>
                </div>
                
                <!-- Right Panel - Opponent -->
                <div class="right-panel">
                    <div class="opponent-info-card">
                        <div class="opponent-label">OPPONENT</div>
                        <div id="opponent-player-name" class="player-name-display">‡∏ù‡πà‡∏≤‡∏¢‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°</div>
                    </div>
                    
                    <div id="opponent-board" class="tetris-board opponent-board"></div>
                    
                    <div class="opponent-stats-card">
                        <div style="margin-bottom: 8px;">
                            <div style="color: #ff6b6b; font-weight: bold;">SCORE</div>
                            <div id="opponent-score">0</div>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <div style="color: #ff6b6b; font-weight: bold;">LINES</div>
                            <div id="opponent-lines">0</div>
                        </div>
                        <div>
                            <div style="color: #ff6b6b; font-weight: bold;">LEVEL</div>
                            <div id="opponent-level">1</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Controls -->
            <div class="mobile-controls">
                <div class="control-grid">
                    <button class="control-button" id="btn-left">‚Üê</button>
                    <button class="control-button" id="btn-right">‚Üí</button>
                    <button class="control-button" id="btn-rotate">‚Üª</button>
                    <button class="control-button" id="btn-drop">üíß</button>
                </div>
                <div class="control-instructions">
                    Swipe: ‚Üê‚Üí ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô, ‚Üë ‡∏´‡∏°‡∏∏‡∏ô, ‚Üì ‡∏î‡∏£‡∏≠‡∏õ
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="screen">
            <div id="winner-message" class="winner-announcement">üéâ ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!</div>
            <div class="final-scores">
                <h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</h3>
                <div class="score-row">
                    <span>Player 1:</span>
                    <span id="final-score-p1">0</span>
                </div>
                <div class="score-row">
                    <span>Player 2:</span>
                    <span id="final-score-p2">0</span>
                </div>
            </div>
            <div class="menu-buttons">
                <button id="btn-play-again" class="btn">üîÑ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                <button onclick="window.location.reload()" class="btn">üè† ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
            </div>
        </div>
    </div>

    <div id="notificationContainer" class="notification-container"></div>

    <script src="client.js"></script>
    <script src="game-class.js"></script>
    <script>
        // Utility function to show screens
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'block';
        }

        // Copy room ID functionality
        function copyRoomId() {
            const roomId = document.getElementById('room-id-display').textContent;
            if (roomId && roomId !== '-') {
                navigator.clipboard.writeText(roomId).then(() => {
                    const notification = document.getElementById('copy-notification');
                    notification.style.display = 'block';
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 2000);
                });
            }
        }

        // Share link functionality
        function shareRoomLink() {
            const roomId = document.getElementById('room-id-display').textContent;
            if (roomId && roomId !== '-') {
                const shareUrl = `${window.location.origin}${window.location.pathname}?room=${roomId}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏° TwoBob Tactics',
                        text: `‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏ó‡∏ï‡∏£‡∏¥‡∏™‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞! ‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á: ${roomId}`,
                        url: shareUrl
                    });
                } else {
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        showNotification('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                    });
                }
            }
        }

        // QR Code functionality
        function showQRCode() {
            const roomId = document.getElementById('room-id-display').textContent;
            if (roomId && roomId !== '-') {
                const shareUrl = `${window.location.origin}${window.location.pathname}?room=${roomId}`;
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(shareUrl)}`;
                
                // Create modal for QR code
                const modal = document.createElement('div');
                modal.className = 'qr-modal';
                modal.innerHTML = `
                    <div class="qr-content">
                        <h3>‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</h3>
                        <img src="${qrUrl}" alt="QR Code">
                        <p>‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á: ${roomId}</p>
                        <button onclick="this.parentElement.parentElement.remove()" class="btn">‡∏õ‡∏¥‡∏î</button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        // Update player progress bar
        function updateProgress(readyCount, totalCount) {
            // Remove progress bar functionality since we removed it from HTML
        }

        // Update ready indicator with animation
        function updateReadyIndicator(playerId, playerName, isReady) {
            const indicator = document.getElementById(`ready-indicator-${playerId}`);
            const playerNameEl = indicator.querySelector('.player-name');
            const statusEl = indicator.querySelector('.player-status');
            
            playerNameEl.textContent = playerName;
            
            if (isReady) {
                statusEl.textContent = '‡∏û‡∏£‡πâ‡∏≠‡∏°!';
                statusEl.className = 'player-status ready';
                indicator.classList.add('player-ready');
            } else {
                statusEl.textContent = '‡∏£‡∏≠...';
                statusEl.className = 'player-status waiting';
                indicator.classList.remove('player-ready');
            }
        }

        // Remove chat functionality since we removed it
        function sendChatMessage() {
            // Removed
        }

        function addChatMessage(sender, message) {
            // Removed
        }

        // Notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.getElementById('notificationContainer').appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof TetrisMultiplayer !== 'undefined') {
                window.tetrisGame = new TetrisMultiplayer();
            }

            // Event listeners for new features
            document.getElementById('btn-copy-room')?.addEventListener('click', copyRoomId);
            document.getElementById('btn-share-link')?.addEventListener('click', shareRoomLink);
            document.getElementById('btn-share-qr')?.addEventListener('click', showQRCode);
            
            // Remove chat event listeners since we removed chat functionality

            // Check for room parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const roomParam = urlParams.get('room');
            if (roomParam) {
                document.getElementById('join-room-id').value = roomParam;
                showScreen('join-room-screen');
            }
        });
    </script>
</body>
</html>
